# Project Selector Feature

## æ¦‚è¿°

æ·»åŠ äº†é¡¹ç›®é€‰æ‹©é¦–é¡µï¼Œç”¨æˆ·å¿…é¡»å…ˆé€‰æ‹©ä¸€ä¸ªå·¥ä½œç›®å½•æ‰èƒ½ä½¿ç”¨CLIåŠŸèƒ½ã€‚æ‰€æœ‰AIç”Ÿæˆçš„æ–‡ä»¶éƒ½å°†ä¿å­˜åœ¨é€‰æ‹©çš„é¡¹ç›®ç›®å½•ä¸­ã€‚

## åŠŸèƒ½å®ç°

### 1. ProjectSelector ç»„ä»¶ ([components/ProjectSelector.tsx](components/ProjectSelector.tsx))

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- å±…ä¸­çš„æ¬¢è¿ç•Œé¢ï¼Œå¸¦æœ‰å“ç‰Œå›¾æ ‡
- æ¸…æ™°çš„è¯´æ˜æŒ‡å¼•ç”¨æˆ·é€‰æ‹©é¡¹ç›®ç›®å½•
- å¤§æŒ‰é’®ä¾¿äºç‚¹å‡»
- æœªæ¥æ”¯æŒæœ€è¿‘é¡¹ç›®åˆ—è¡¨

**ç”¨æˆ·ä½“éªŒï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚          [Folder Icon]              â”‚
â”‚                                     â”‚
â”‚      Gemini Code Studio             â”‚
â”‚   AI-powered IDE for web dev        â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é€‰æ‹©é¡¹ç›®ç›®å½•è¯´æ˜              â”‚   â”‚
â”‚  â”‚ - æ–°é¡¹ç›®ï¼šé€‰æ‹©ç©ºç›®å½•          â”‚   â”‚
â”‚  â”‚ - ç»§ç»­ï¼šé€‰æ‹©ç°æœ‰é¡¹ç›®          â”‚   â”‚
â”‚  â”‚ - æ‰€æœ‰æ–‡ä»¶ä¿å­˜åœ¨æ­¤            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    ğŸ“ Open Project          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Tauri Dialog æ’ä»¶é›†æˆ

**æ·»åŠ çš„ä¾èµ–ï¼š**
- Frontend: `@tauri-apps/plugin-dialog@2.4.2`
- Backend: `tauri-plugin-dialog = "2.0"`

**æƒé™é…ç½®** ([src-tauri/capabilities/default.json](src-tauri/capabilities/default.json:9-10)):
```json
{
  "permissions": [
    "dialog:default",
    "dialog:allow-open"
  ]
}
```

**Rust åˆå§‹åŒ–** ([src-tauri/src/lib.rs](src-tauri/src/lib.rs:105)):
```rust
.plugin(tauri_plugin_dialog::init())
```

### 3. App.tsx é›†æˆ ([App.tsx](App.tsx))

**çŠ¶æ€ç®¡ç†ï¼š**
```typescript
const [projectDir, setProjectDir] = useState<string | null>(null);
```

**æ¡ä»¶æ¸²æŸ“ï¼š**
```typescript
// å¦‚æœæ²¡æœ‰é€‰æ‹©é¡¹ç›®ï¼Œæ˜¾ç¤º ProjectSelector
if (!projectDir) {
  return <ProjectSelector onProjectSelect={setProjectDir} />;
}

// å¦åˆ™æ˜¾ç¤ºä¸»ç•Œé¢
return <MainUI />;
```

**è‡ªåŠ¨è®¾ç½®åˆ° CLI Routerï¼š**
```typescript
useEffect(() => {
  if (projectDir) {
    cliRouter.setProjectDir(projectDir);
    // æ·»åŠ æ¬¢è¿æ¶ˆæ¯æ˜¾ç¤ºé¡¹ç›®è·¯å¾„
    setMessages(prev => [...prev, {
      text: `Project directory set to: ${projectDir}

All generated files will be saved in this directory.`
    }]);
  }
}, [projectDir]);
```

### 4. CLI Router æ›´æ–° ([services/cliRouter.ts](services/cliRouter.ts))

**é¡¹ç›®ç›®å½•ç®¡ç†ï¼š**
```typescript
export class CLIRouter {
  private projectDir: string | null = null;

  setProjectDir(dir: string) {
    this.projectDir = dir;
    console.log('[CLIRouter] Project directory set to:', dir);
  }

  getProjectDir(): string | null {
    return this.projectDir;
  }
}
```

**Claude CLI å‚æ•°ï¼š**
```typescript
const command = Command.create('node', [
  claudePath,
  '--print',
  '--output-format', 'json',
  '--model', 'sonnet',
  '--dangerously-skip-permissions',
  '--add-dir', this.projectDir!,  // æ·»åŠ é¡¹ç›®ç›®å½•
  fullPrompt
]);
```

**å®‰å…¨æ£€æŸ¥ï¼š**
```typescript
async sendMessage(tool: CLITool, message: string, history: CLIMessage[]) {
  if (!this.projectDir) {
    throw new Error('Project directory not set. Please select a project directory first.');
  }
  // ... è·¯ç”±åˆ°ç›¸åº”çš„ CLI
}
```

## ä½¿ç”¨æµç¨‹

### 1. å¯åŠ¨åº”ç”¨
```bash
pnpm tauri:dev
```

### 2. ç”¨æˆ·æµç¨‹

**æ­¥éª¤ 1ï¼š** åº”ç”¨å¯åŠ¨åçœ‹åˆ°é¡¹ç›®é€‰æ‹©ç•Œé¢

**æ­¥éª¤ 2ï¼š** ç‚¹å‡» "Open Project" æŒ‰é’®

**æ­¥éª¤ 3ï¼š** ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨æ‰“å¼€

**æ­¥éª¤ 4ï¼š** é€‰æ‹©æˆ–åˆ›å»ºé¡¹ç›®ç›®å½•

**æ­¥éª¤ 5ï¼š** ç¡®è®¤é€‰æ‹©åï¼Œè¿›å…¥ä¸»ç•Œé¢

**æ­¥éª¤ 6ï¼š** çœ‹åˆ°ç¡®è®¤æ¶ˆæ¯æ˜¾ç¤ºé¡¹ç›®è·¯å¾„

**æ­¥éª¤ 7ï¼š** å¼€å§‹ä½¿ç”¨ CLI ç”Ÿæˆä»£ç 

### 3. Claude Code å·¥ä½œæµ

å½“ç”¨æˆ·å‘é€è¯·æ±‚æ—¶ï¼ˆä¾‹å¦‚ï¼š"åˆ›å»ºä¸€ä¸ª HTML æ–‡ä»¶"ï¼‰ï¼š

1. **CLI Router æ£€æŸ¥**ï¼šç¡®è®¤é¡¹ç›®ç›®å½•å·²è®¾ç½®
2. **æ‰§è¡Œå‘½ä»¤**ï¼š
   ```bash
   node ~/.opencode/cli/node_modules/.bin/claude \
     --print \
     --output-format json \
     --model sonnet \
     --dangerously-skip-permissions \
     --add-dir /path/to/selected/project \
     "åˆ›å»ºä¸€ä¸ª HTML æ–‡ä»¶"
   ```
3. **Claude å·¥ä½œ**ï¼šåœ¨æŒ‡å®šç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶
4. **å“åº”è¿”å›**ï¼šæ˜¾ç¤ºåœ¨èŠå¤©é¢æ¿ä¸­
5. **æ–‡ä»¶ä¿å­˜**ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸­æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶

## æŠ€æœ¯ç»†èŠ‚

### Dialog API ä½¿ç”¨

```typescript
import { open } from '@tauri-apps/plugin-dialog';

const selected = await open({
  directory: true,      // åªé€‰æ‹©ç›®å½•
  multiple: false,      // å•é€‰
  title: 'Select Project Directory'
});
```

### Claude CLI --add-dir å‚æ•°

è¿™ä¸ªå‚æ•°å‘Šè¯‰ Claude Code CLIï¼š
- âœ… å…è®¸è®¿é—®æŒ‡å®šç›®å½•
- âœ… åœ¨è¯¥ç›®å½•ä¸­åˆ›å»º/ä¿®æ”¹æ–‡ä»¶
- âœ… è¯»å–è¯¥ç›®å½•ä¸­çš„ç°æœ‰æ–‡ä»¶
- âŒ ä¸èƒ½è®¿é—®å…¶ä»–ç›®å½•

é…åˆ `--dangerously-skip-permissions` ä½¿ç”¨ï¼š
- è·³è¿‡äº¤äº’å¼æƒé™æç¤º
- é€‚åˆ UI é›†æˆåœºæ™¯
- ç¡®ä¿éé˜»å¡æ‰§è¡Œ

## æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶
1. `components/ProjectSelector.tsx` - é¡¹ç›®é€‰æ‹©å™¨ç»„ä»¶
2. `PROJECT_SELECTOR.md` - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
1. `App.tsx` - æ·»åŠ æ¡ä»¶æ¸²æŸ“å’Œé¡¹ç›®ç›®å½•ç®¡ç†
2. `services/cliRouter.ts` - æ·»åŠ é¡¹ç›®ç›®å½•è®¾ç½®å’Œä½¿ç”¨
3. `src-tauri/Cargo.toml` - æ·»åŠ  dialog æ’ä»¶ä¾èµ–
4. `src-tauri/src/lib.rs` - åˆå§‹åŒ– dialog æ’ä»¶
5. `src-tauri/capabilities/default.json` - æ·»åŠ  dialog æƒé™
6. `package.json` - æ·»åŠ  @tauri-apps/plugin-dialog

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
1. **é€‰æ‹©ç©ºç›®å½•**ï¼š
   - åˆ›å»ºæ–°ç›®å½•å¹¶é€‰æ‹©
   - è¯·æ±‚ Claude åˆ›å»ºæ–‡ä»¶
   - éªŒè¯æ–‡ä»¶åœ¨è¯¥ç›®å½•ä¸­

2. **é€‰æ‹©ç°æœ‰é¡¹ç›®**ï¼š
   - é€‰æ‹©åŒ…å«æ–‡ä»¶çš„ç›®å½•
   - è¯·æ±‚ä¿®æ”¹ç°æœ‰æ–‡ä»¶
   - éªŒè¯ Claude èƒ½è¯»å–å’Œä¿®æ”¹

3. **å–æ¶ˆé€‰æ‹©**ï¼š
   - ç‚¹å‡» "Open Project"
   - å–æ¶ˆå¯¹è¯æ¡†
   - åº”è¯¥åœç•™åœ¨é€‰æ‹©ç•Œé¢

4. **è·¯å¾„æ˜¾ç¤º**ï¼š
   - é€‰æ‹©ç›®å½•å
   - éªŒè¯æ¬¢è¿æ¶ˆæ¯æ˜¾ç¤ºæ­£ç¡®è·¯å¾„
   - è·¯å¾„åº”è¯¥å®Œæ•´å¯è¯»

### é›†æˆæµ‹è¯•
1. **æ–‡ä»¶åˆ›å»º**ï¼š
   ```
   ç”¨æˆ·: "åˆ›å»ºä¸€ä¸ª index.html"
   æœŸæœ›: æ–‡ä»¶åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»º
   ```

2. **å¤šæ–‡ä»¶é¡¹ç›®**ï¼š
   ```
   ç”¨æˆ·: "åˆ›å»ºä¸€ä¸ªå¸¦ CSS å’Œ JS çš„ç½‘é¡µ"
   æœŸæœ›: 3ä¸ªæ–‡ä»¶éƒ½åœ¨é¡¹ç›®ç›®å½•ä¸­
   ```

3. **ç›®å½•ç»“æ„**ï¼š
   ```
   ç”¨æˆ·: "åˆ›å»º src/components/Button.tsx"
   æœŸæœ›: è‡ªåŠ¨åˆ›å»ºå­ç›®å½•ç»“æ„
   ```

## æœªæ¥å¢å¼º

### åŠŸèƒ½æ‰©å±•
- [ ] è®°ä½æœ€è¿‘æ‰“å¼€çš„é¡¹ç›®
- [ ] é¡¹ç›®åˆ—è¡¨å¿«é€Ÿåˆ‡æ¢
- [ ] é¡¹ç›®å…ƒæ•°æ®å­˜å‚¨ï¼ˆåç§°ã€æè¿°ï¼‰
- [ ] é¡¹ç›®æ¨¡æ¿é€‰æ‹©
- [ ] Git é›†æˆæ£€æµ‹

### UI æ”¹è¿›
- [ ] é¡¹ç›®å›¾æ ‡è‡ªå®šä¹‰
- [ ] æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢
- [ ] æ‹–æ”¾ç›®å½•é€‰æ‹©
- [ ] å¿«æ·é”®æ”¯æŒï¼ˆCmd+Oï¼‰

### å®‰å…¨å¢å¼º
- [ ] ç›®å½•è®¿é—®æƒé™éªŒè¯
- [ ] æ•æ„Ÿç›®å½•è­¦å‘Š
- [ ] æ–‡ä»¶æ“ä½œæ—¥å¿—
- [ ] æ“ä½œæ’¤é”€åŠŸèƒ½

## å·²çŸ¥é™åˆ¶

1. **å•é¡¹ç›®æ¨¡å¼**ï¼šç›®å‰ä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªé¡¹ç›®
2. **æ— æŒä¹…åŒ–**ï¼šå…³é—­åº”ç”¨åéœ€è¦é‡æ–°é€‰æ‹©
3. **è·¯å¾„ä¾èµ–**ï¼šmacOS arm64 ç¡¬ç¼–ç è·¯å¾„
4. **æ— éªŒè¯**ï¼šä¸æ£€æŸ¥ç›®å½•æƒé™æˆ–å¯ç”¨ç©ºé—´

## æ€»ç»“

é¡¹ç›®é€‰æ‹©å™¨åŠŸèƒ½å·²å®Œå…¨é›†æˆï¼Œæä¾›äº†ï¼š
- âœ… å‹å¥½çš„ç”¨æˆ·ç•Œé¢
- âœ… å®‰å…¨çš„ç›®å½•é€‰æ‹©
- âœ… ä¸ Claude CLI çš„å®Œæ•´é›†æˆ
- âœ… æ¸…æ™°çš„ç”¨æˆ·åé¦ˆ
- âœ… éé˜»å¡çš„æ–‡ä»¶æ“ä½œ

ç°åœ¨ç”¨æˆ·å¯ä»¥å®‰å…¨åœ°é€‰æ‹©å·¥ä½œç›®å½•ï¼Œæ‰€æœ‰ AI ç”Ÿæˆçš„æ–‡ä»¶éƒ½ä¼šä¿å­˜åœ¨æŒ‡å®šä½ç½®ï¼Œå®ç°äº†å®Œæ•´çš„é¡¹ç›®ç®¡ç†å·¥ä½œæµã€‚
